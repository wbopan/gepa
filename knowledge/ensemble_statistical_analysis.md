# Ensemble 统计分析报告

> 分析日期: 2026-02-01
> 数据来源: WandB bmpixel/gepa-boost 项目，adaboost run

---

## 1. 数据概览

| 指标 | 值 |
|------|-----|
| 验证集样本数 | 30 |
| 候选者总数 | 37 |
| 单体最优分数 | 80% (24/30) - Candidate #5 |
| Oracle 上限 | 93.3% (28/30) |
| Ensemble Gain | +13.3% (+4 samples) |

---

## 2. Greedy Max-Sum 选择结果

使用 Greedy Max-Sum 算法从 Pareto 前沿选择 k=5 个候选者：

| 选择顺序 | Candidate | 单体分数 | 边际贡献 | 解决的独特样本 |
|----------|-----------|----------|----------|----------------|
| 1 | #5 | 0.800 | 24 samples | 基线 |
| 2 | #29 | 0.633 | +1 | Sample 12 |
| 3 | #18 | 0.667 | +1 | Sample 15 |
| 4 | #17 | 0.633 | +1 | Sample 8 |
| 5 | #15 | 0.600 | +1 | Sample 20 |

达到 Oracle (28/30) 需要 k=5 个候选者。

---

## 3. 候选者谱系分析

### 3.1 Specialists 的来源

| Specialist | 分数 | 直接父代 | 父代分数 |
|------------|------|----------|----------|
| #15 | 0.600 | #5 | 0.800 |
| #17 | 0.633 | #5 | 0.800 |
| #18 | 0.667 | #17 | 0.633 |
| #29 | 0.633 | #28 | 0.733 |

只有 #15 和 #17 是 #5 的直接子代。#18 和 #29 是更远的后代。

### 3.2 #5 的所有子代

Candidate #5 被变异了 18 次（最多），产生以下子代：

| 子代 | 分数 | 是否 Specialist |
|------|------|-----------------|
| #23 | 0.733 | No |
| #27 | 0.733 | No |
| #28 | 0.733 | No |
| #9 | 0.700 | No |
| #10 | 0.700 | No |
| #14 | 0.700 | No |
| #19 | 0.700 | No |
| #8 | 0.667 | No |
| #6 | 0.633 | No |
| #11 | 0.633 | No |
| #12 | 0.633 | No |
| #17 | 0.633 | **Yes** |
| #20 | 0.633 | No |
| #24 | 0.633 | No |
| #25 | 0.633 | No |
| #13 | 0.600 | No |
| #15 | 0.600 | **Yes** |
| #7 | 0.400 | No |

关键观察：**所有 18 个子代的分数都低于父代 #5 (0.800)**

---

## 4. 统计检验结果

### 4.1 Test 1: Oracle vs Single Best

**假设**: Ensemble (Oracle) 显著优于 Single Best

| 指标 | 值 |
|------|-----|
| Single Best | 24/30 = 80.0% |
| Oracle | 28/30 = 93.3% |
| Improvement | 13.3% |
| 95% CI | [1.2%, 25.5%] |
| Binomial test p-value | 0.038 |
| **结论** | **显著 (p < 0.05)** |

### 4.2 Test 2: Specialists vs Non-Specialists 分数

**假设**: Specialists 有更高的分数

在 #5 的 18 个直接子代中：
- Specialists (n=2): #15, #17
- Non-specialists (n=16): 其他所有

| 组别 | 样本量 | 平均分数 |
|------|--------|----------|
| Specialists | 2 | 0.617 |
| Non-specialists | 16 | 0.654 |
| 差异 | - | **-0.037** (Specialists 更低!) |

| 检验 | 结果 |
|------|------|
| Mann-Whitney U p-value | 0.189 |
| Cohen's d | -0.631 |
| **结论** | **不显著，方向相反** |

### 4.3 Test 3: 化学关键词模式

**假设**: Specialists 添加了更多化学领域关键词

检测关键词: thermodynamic, enthalpy, entropy, gibbs, equilibrium, reaction, molecular, bond, oxidation, reduction

| 组别 | 化学关键词增量 (相对于 #5) |
|------|---------------------------|
| #5 (基线) | 1 个关键词 |
| Specialists (n=2) | +2.0 平均 |
| Non-specialists (n=16) | +2.38 平均 |

| 检验 | 结果 |
|------|------|
| Mann-Whitney U p-value | 0.854 |
| **结论** | **不显著，方向相反** |

---

## 5. 综合结论

### 5.1 统计显著性汇总

| 发现 | 样本量 | p-value | 显著性 |
|------|--------|---------|--------|
| Oracle > Single Best | n=30 | 0.038 | ✅ 显著 |
| Specialists 有更高分数 | n=2 vs n=16 | 0.189 | ❌ 不显著 |
| 化学关键词导致成功 | n=2 vs n=16 | 0.854 | ❌ 方向相反 |

### 5.2 核心发现

1. **Ensemble Gain 是真实的**: 13.3% 的提升统计显著 (p=0.038)

2. **但"专业化"假设不成立**:
   - Specialists 的平均分数实际上**低于** Non-specialists
   - Non-specialists 添加了**更多**化学关键词
   - Specialists 解决难题是随机变异的结果，同时在其他题目上丢分

3. **Ensemble 的收益来源**:
   - 不是有意义的专业化
   - 而是 LLM 输出的**自然方差**导致的不同失败模式
   - Greedy Max-Sum 利用了这种自然多样性

### 5.3 对实施计划的影响

| Phase | 原计划 | 基于数据的建议 |
|-------|--------|----------------|
| Phase 1 | Oracle Score 追踪 + Greedy Max-Sum | ✅ 验证有效，应该实施 |
| Phase 2 | BlindSpotSampler | ❓ 可能不必要 |
| Phase 3 | SpecialistProposer | ❓ 可能不必要 |
| Phase 4 | Embedding Router | ✅ 可以直接利用自然多样性 |

### 5.4 局限性

1. 验证集只有 30 个样本，统计功效有限
2. Specialists 只有 2 个，样本量太小无法做可靠推断
3. 单次运行，没有跨种子复制
4. 未进行多重比较校正

---

## 6. Majority Voting 模拟 (2026-02-01 补充)

### 6.1 模拟设置

使用 Greedy Max-Sum 选出的 5 个候选者进行 Majority Voting：
- Candidates: #5 (Generalist), #15, #17, #18, #29 (Specialists)
- 投票规则: ≥3/5 正确即判定正确

### 6.2 结果

| 策略 | 正确率 | 相对 Single Best |
|------|--------|------------------|
| Single Best (#5) | 80.0% (24/30) | 基线 |
| **Majority Vote** | **73.3% (22/30)** | **-6.7%** |
| Oracle | 93.3% (28/30) | +13.3% |

**关键发现：Majority Vote 比 Single Best 还差 6.7%！**

### 6.3 失败原因分析

| 样本 | 答对者 | 答错者 | 投票结果 |
|------|--------|--------|----------|
| Sample 12 | #29 (1) | #5, #18, #17, #15 (4) | ❌ 错误 |
| Sample 15 | #18 (1) | #5, #29, #17, #15 (4) | ❌ 错误 |
| Sample 20 | #15 (1) | #5, #29, #18, #17 (4) | ❌ 错误 |
| Sample 8 | #17 (1) | #5, #29, #18, #15 (4) | ❌ 错误 |

这正是 Greedy Max-Sum 选择这些候选者的原因：它们各自能解决一个**独特的**难题。但这也意味着在这些难题上，4 个模型投错票，只有 1 个投对票，Majority Vote 必然失败。

### 6.4 Gemini 的诊断

> 这些所谓的"专家"实际上是高度特化的**偏科生 (Idiot Savants)**。它们在获得解决难样本能力的同时，牺牲了通用能力。
>
> **结论：在这种 Ensemble 构成下，民主（Voting）是行不通的，必须依靠独裁（Routing）。**

### 6.5 Gemini 建议的替代策略

#### 策略 A: Argmax Probability (最大置信度选择)
让所有 k 个模型回答，选择置信度最高的答案。

**假设**：答对的模型往往比答错的模型置信度更高。

**状态**：⚠️ 待验证（当前数据未保存 logprobs）

#### 策略 B: k-NN Router (k=1)
1. 计算 Test Sample 的 Embedding
2. 在 Validation Set 中找到最近的邻居
3. 查看那个邻居被谁解决
4. 直接指派该候选者回答

**假设**："运气"在相似样本间可以迁移。

**状态**：⚠️ 待验证

#### 策略 C: Confidence-Based Cascade (置信度级联) - 推荐
1. 所有题目先给 Single Best (#5)
2. 如果 #5 的置信度 > 阈值 τ，直接输出
3. 只有 #5 不确定时，才启动 Router 或调用其他模型

**优势**：保底策略，几乎零风险

---

## 7. 修订后的实施建议

### 原计划 vs 新计划

| 模块 | 原计划 | 数据验证后 | 最终建议 |
|------|--------|------------|----------|
| Phase 1 (Greedy Max-Sum) | ✅ | ✅ 验证有效 | ✅ 保留 |
| Phase 2 (BlindSpotSampler) | ✅ | ❓ 专业化不存在 | ⚠️ 改为 DivergentSampler |
| Phase 3 (SpecialistProposer) | ✅ | ❌ 化学关键词无效 | ❌ 废弃或重构 |
| Phase 4 (Embedding Router) | ✅ | ❌ 语义路由不可行 | 🔄 改为 k-NN Instance Router |
| **新增：Majority Vote** | - | ❌ 比 Single Best 更差 | ❌ 不推荐 |
| **新增：Cascade Strategy** | - | - | ✅ 推荐作为保底 |

### 关键结论

1. **Ensemble Gain 是真实的** (+13.3%)，但**只有 Oracle 能实现**
2. **Majority Vote 反而有害** (-6.7%)，因为 Specialists 是"偏科生"
3. **必须使用精确路由**，否则得不偿失
4. **保底策略**：Cascade + 只在低置信度时尝试路由

---

## 6. 原始数据

### 6.1 难题分布

| 难度 | 样本 ID | 解决者 |
|------|---------|--------|
| 最难 (0% 正确率) | 4, 29 | 无人解决 |
| 较难 | 12 | 仅 #29 |
| 较难 | 15 | 仅 #18 |
| 较难 | 8 | #17, #21 |
| 较难 | 20 | #15, #28, #27, #3 |

### 6.2 Pareto 前沿覆盖

- 6 个样本无人答对 (4, 29 + 4 others)
- 4 个样本只有 1-2 个候选者答对 (8, 12, 15, 20)
- 20 个样本被多个候选者覆盖
